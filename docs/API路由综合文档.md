# SmartTutor 系统 API 路由综合文档

本文档提供了 SmartTutor 系统所有 API 路由的详细说明，包括请求方法、URL、参数和访问权限。

## 目录

1. [认证 API](#认证-api)
2. [用户管理 API](#用户管理-api)
3. [教师档案 API](#教师档案-api)
4. [家长档案 API](#家长档案-api)
5. [子女信息 API](#子女信息-api)
6. [家教需求 API](#家教需求-api)
7. [推荐系统 API](#推荐系统-api)
8. [地理位置 API](#地理位置-api)
9. [消息交流 API](#消息交流-api)
10. [管理员 API](#管理员-api)

## 认证 API

### 用户注册

- **路径**: `/api/auth/register`
- **方法**: `POST`
- **描述**: 注册新用户
- **访问权限**: 公开
- **请求体**:
  ```json
  {
    "username": "用户名",
    "email": "邮箱",
    "password": "密码",
    "role": "角色(teacher/parent/admin)"
  }
  ```
- **响应**: 返回用户信息和认证令牌

### 用户登录

- **路径**: `/api/auth/login`
- **方法**: `POST`
- **描述**: 用户登录
- **访问权限**: 公开
- **请求体**:
  ```json
  {
    "email": "邮箱",
    "password": "密码"
  }
  ```
- **响应**: 返回用户信息和认证令牌

## 用户管理 API

所有用户管理 API 都需要认证令牌。

### 获取用户列表

- **路径**: `/api/users`
- **方法**: `GET`
- **描述**: 获取所有用户列表
- **访问权限**: 仅管理员
- **响应**: 返回用户列表

### 获取单个用户信息

- **路径**: `/api/users/:customId`
- **方法**: `GET`
- **描述**: 获取指定用户的详细信息
- **访问权限**: 认证用户
- **响应**: 返回用户详细信息

### 更新用户信息

- **路径**: `/api/users/:customId/update`
- **方法**: `POST`
- **描述**: 更新用户信息
- **访问权限**: 认证用户（仅自己）
- **请求体**: 用户信息字段
- **响应**: 返回更新后的用户信息

### 更新用户状态

- **路径**: `/api/users/:customId/status`
- **方法**: `POST`
- **描述**: 更新用户状态（启用/禁用）
- **访问权限**: 仅管理员
- **请求体**:
  ```json
  {
    "status": "active/inactive"
  }
  ```
- **响应**: 返回更新后的用户状态

## 教师档案 API

### 公共路由（无需认证）

#### 查询教师列表

- **路径**: `/api/tutors`
- **方法**: `GET`
- **描述**: 查询教师列表，支持分页和筛选
- **访问权限**: 公开
- **查询参数**:
  - `page`: 页码
  - `limit`: 每页数量
  - `subject`: 科目
  - `location`: 位置
  - `rating`: 评分
- **响应**: 返回教师列表

#### 按科目查找教师

- **路径**: `/api/tutors/subject/:subject`
- **方法**: `GET`
- **描述**: 按科目查找教师
- **访问权限**: 公开
- **响应**: 返回符合条件的教师列表

#### 按位置查找教师

- **路径**: `/api/tutors/location/:city/:district?`
- **方法**: `GET`
- **描述**: 按城市和区域（可选）查找教师
- **访问权限**: 公开
- **响应**: 返回符合条件的教师列表

#### 查找附近教师

- **路径**: `/api/tutors/nearby`
- **方法**: `GET`
- **描述**: 查找附近教师
- **访问权限**: 公开
- **查询参数**:
  - `latitude`: 纬度
  - `longitude`: 经度
  - `distance`: 距离（公里）
- **响应**: 返回附近的教师列表

#### 获取教师详情

- **路径**: `/api/tutors/:tutorId`
- **方法**: `GET`
- **描述**: 获取教师详细信息
- **访问权限**: 公开
- **响应**: 返回教师详细信息

#### 获取推荐教师

- **路径**: `/api/tutors/recommend`
- **方法**: `POST`
- **描述**: 获取推荐教师
- **访问权限**: 公开
- **请求体**:
  ```json
  {
    "subject": "科目",
    "grade": "年级",
    "location": "位置",
    "preferences": ["偏好1", "偏好2"]
  }
  ```
- **响应**: 返回推荐教师列表

### 需要认证的路由（教师角色）

#### 创建教师档案

- **路径**: `/api/profile`
- **方法**: `POST`
- **描述**: 创建教师档案
- **访问权限**: 仅教师
- **请求体**: 教师档案信息
- **响应**: 返回创建的教师档案

#### 获取个人教师档案

- **路径**: `/api/profile`
- **方法**: `GET`
- **描述**: 获取当前登录教师的档案
- **访问权限**: 仅教师
- **响应**: 返回教师档案

#### 更新教师档案

- **路径**: `/api/profile`
- **方法**: `PATCH`
- **描述**: 更新教师档案
- **访问权限**: 仅教师
- **请求体**: 需要更新的字段
- **响应**: 返回更新后的教师档案

#### 删除教师档案

- **路径**: `/api/profile`
- **方法**: `DELETE`
- **描述**: 删除教师档案
- **访问权限**: 仅教师
- **响应**: 返回删除结果

#### 更新可用状态

- **路径**: `/api/profile/status`
- **方法**: `PATCH`
- **描述**: 更新教师可用状态
- **访问权限**: 仅教师
- **请求体**:
  ```json
  {
    "status": "available/unavailable"
  }
  ```
- **响应**: 返回更新后的状态

#### 科目管理

##### 添加科目

- **路径**: `/api/profile/subjects`
- **方法**: `POST`
- **描述**: 添加教授科目
- **访问权限**: 仅教师
- **请求体**: 科目信息
- **响应**: 返回更新后的科目列表

##### 更新科目

- **路径**: `/api/profile/subjects/:subjectId`
- **方法**: `PATCH`
- **描述**: 更新科目信息
- **访问权限**: 仅教师
- **请求体**: 需要更新的科目字段
- **响应**: 返回更新后的科目信息

##### 删除科目

- **路径**: `/api/profile/subjects/:subjectId`
- **方法**: `DELETE`
- **描述**: 删除科目
- **访问权限**: 仅教师
- **响应**: 返回删除结果

#### 成功案例管理

##### 添加成功案例

- **路径**: `/api/profile/subjects/:subjectId/cases`
- **方法**: `POST`
- **描述**: 添加成功案例
- **访问权限**: 仅教师
- **请求体**: 成功案例信息
- **响应**: 返回更新后的成功案例列表

##### 更新成功案例

- **路径**: `/api/profile/subjects/:subjectId/cases/:caseId`
- **方法**: `PATCH`
- **描述**: 更新成功案例
- **访问权限**: 仅教师
- **请求体**: 需要更新的成功案例字段
- **响应**: 返回更新后的成功案例

##### 删除成功案例

- **路径**: `/api/profile/subjects/:subjectId/cases/:caseId`
- **方法**: `DELETE`
- **描述**: 删除成功案例
- **访问权限**: 仅教师
- **响应**: 返回删除结果

#### 课程时间管理

##### 添加时间段

- **路径**: `/api/profile/sessions`
- **方法**: `POST`
- **描述**: 添加可授课时间段
- **访问权限**: 仅教师
- **请求体**: 时间段信息
- **响应**: 返回更新后的时间段列表

##### 更新时间段

- **路径**: `/api/profile/sessions/:sessionId`
- **方法**: `PATCH`
- **描述**: 更新时间段
- **访问权限**: 仅教师
- **请求体**: 需要更新的时间段字段
- **响应**: 返回更新后的时间段

##### 删除时间段

- **路径**: `/api/profile/sessions/:sessionId`
- **方法**: `DELETE`
- **描述**: 删除时间段
- **访问权限**: 仅教师
- **响应**: 返回删除结果

##### 更新默认时间

- **路径**: `/api/profile/default-times`
- **方法**: `PATCH`
- **描述**: 更新默认可授课时间
- **访问权限**: 仅教师
- **请求体**: 默认时间信息
- **响应**: 返回更新后的默认时间

#### 其他信息管理

##### 更新位置信息

- **路径**: `/api/profile/location`
- **方法**: `PATCH`
- **描述**: 更新位置信息
- **访问权限**: 仅教师
- **请求体**: 位置信息
- **响应**: 返回更新后的位置信息

##### 更新价格信息

- **路径**: `/api/profile/pricing`
- **方法**: `PATCH`
- **描述**: 更新价格信息
- **访问权限**: 仅教师
- **请求体**: 价格信息
- **响应**: 返回更新后的价格信息

##### 更新教学风格

- **路径**: `/api/profile/teaching-style`
- **方法**: `PATCH`
- **描述**: 更新教学风格
- **访问权限**: 仅教师
- **请求体**: 教学风格信息
- **响应**: 返回更新后的教学风格

## 家长档案 API

所有家长档案 API 都需要认证令牌。

### 创建家长档案

- **路径**: `/api/parents`
- **方法**: `POST`
- **描述**: 创建家长档案
- **访问权限**: 认证用户（家长角色）
- **请求体**: 家长档案信息
- **响应**: 返回创建的家长档案

### 获取家长档案

- **路径**: `/api/parents/:parentId`
- **方法**: `GET`
- **描述**: 获取家长档案
- **访问权限**: 认证用户
- **响应**: 返回家长档案

### 更新家长档案

- **路径**: `/api/parents/:parentId`
- **方法**: `PUT`
- **描述**: 更新家长档案
- **访问权限**: 认证用户（家长角色）
- **请求体**: 需要更新的字段
- **响应**: 返回更新后的家长档案

### 删除家长档案

- **路径**: `/api/parents/:parentId`
- **方法**: `DELETE`
- **描述**: 删除家长档案
- **访问权限**: 认证用户
- **响应**: 返回删除结果

## 子女信息 API

所有子女信息 API 都需要认证令牌。

### 添加子女信息

- **路径**: `/api/parents/:parentId/children`
- **方法**: `POST`
- **描述**: 添加子女信息
- **访问权限**: 认证用户
- **请求体**: 子女信息
- **响应**: 返回创建的子女信息

### 获取子女信息列表

- **路径**: `/api/parents/:parentId/children`
- **方法**: `GET`
- **描述**: 获取子女信息列表
- **访问权限**: 认证用户
- **响应**: 返回子女信息列表

### 获取单个子女信息

- **路径**: `/api/parents/:parentId/children/:childId`
- **方法**: `GET`
- **描述**: 获取单个子女信息
- **访问权限**: 认证用户
- **响应**: 返回子女信息

### 更新子女信息

- **路径**: `/api/parents/:parentId/children/:childId`
- **方法**: `PUT`
- **描述**: 更新子女信息
- **访问权限**: 认证用户
- **请求体**: 需要更新的字段
- **响应**: 返回更新后的子女信息

### 删除子女信息

- **路径**: `/api/parents/:parentId/children/:childId`
- **方法**: `DELETE`
- **描述**: 删除子女信息
- **访问权限**: 认证用户
- **响应**: 返回删除结果

## 家教需求 API

所有家教需求 API 都需要认证令牌。

### 创建家教需求帖子

- **路径**: `/api/requests`
- **方法**: `POST`
- **描述**: 创建家教需求帖子
- **访问权限**: 认证用户（家长角色）
- **请求体**: 家教需求信息
- **响应**: 返回创建的家教需求

### 获取单个家教需求帖子

- **路径**: `/api/requests/:requestId`
- **方法**: `GET`
- **描述**: 获取单个家教需求帖子
- **访问权限**: 认证用户
- **响应**: 返回家教需求详情

### 更新家教需求帖子

- **路径**: `/api/requests/:requestId`
- **方法**: `PUT`
- **描述**: 更新家教需求帖子
- **访问权限**: 认证用户（家长角色）
- **请求体**: 需要更新的字段
- **响应**: 返回更新后的家教需求

### 删除家教需求帖子

- **路径**: `/api/requests/:requestId`
- **方法**: `DELETE`
- **描述**: 删除家教需求帖子
- **访问权限**: 认证用户（家长角色）
- **响应**: 返回删除结果

### 查询家教需求帖子列表

- **路径**: `/api/requests`
- **方法**: `GET`
- **描述**: 查询家教需求帖子列表
- **访问权限**: 认证用户
- **查询参数**:
  - `page`: 页码
  - `limit`: 每页数量
  - `subject`: 科目
  - `grade`: 年级
  - `location`: 位置
- **响应**: 返回家教需求列表

## 推荐系统 API

所有推荐系统 API 都需要认证令牌。

### 获取推荐给教师的家教需求

- **路径**: `/api/recommendations/tutor/requests`
- **方法**: `GET`
- **描述**: 获取推荐给教师的家教需求
- **访问权限**: 认证用户（教师角色）
- **响应**: 返回推荐的家教需求列表

### 获取推荐给家长的教师

- **路径**: `/api/recommendations/parent/tutors`
- **方法**: `GET`
- **描述**: 获取推荐给家长的教师
- **访问权限**: 认证用户（家长角色）
- **响应**: 返回推荐的教师列表

## 地理位置 API

### 公共路由（无需认证）

#### 地址解析

- **路径**: `/api/geolocation/geocode`
- **方法**: `GET`
- **描述**: 地址解析（地址转坐标）
- **访问权限**: 公开
- **查询参数**:
  - `address`: 地址
- **响应**: 返回坐标信息

#### 逆地址解析

- **路径**: `/api/geolocation/regeocode`
- **方法**: `GET`
- **描述**: 逆地址解析（坐标转地址）
- **访问权限**: 公开
- **查询参数**:
  - `latitude`: 纬度
  - `longitude`: 经度
- **响应**: 返回地址信息

#### IP定位

- **路径**: `/api/geolocation/ip`
- **方法**: `GET`
- **描述**: IP定位
- **访问权限**: 公开
- **查询参数**:
  - `ip`: IP地址（可选，默认为请求IP）
- **响应**: 返回位置信息

#### 计算距离

- **路径**: `/api/geolocation/distance`
- **方法**: `POST`
- **描述**: 计算两点之间的距离
- **访问权限**: 公开
- **请求体**:
  ```json
  {
    "origin": {
      "latitude": 纬度,
      "longitude": 经度
    },
    "destination": {
      "latitude": 纬度,
      "longitude": 经度
    }
  }
  ```
- **响应**: 返回距离信息

#### 搜索兴趣点

- **路径**: `/api/geolocation/search`
- **方法**: `GET`
- **描述**: 搜索兴趣点
- **访问权限**: 公开
- **查询参数**:
  - `keyword`: 关键词
  - `city`: 城市
  - `type`: 类型
- **响应**: 返回兴趣点列表

#### 获取当前位置信息

- **路径**: `/api/geolocation/current`
- **方法**: `GET`
- **描述**: 获取当前位置信息
- **访问权限**: 公开
- **响应**: 返回当前位置信息

### 需要认证的路由

#### 更新用户地理位置

- **路径**: `/api/geolocation/user/update`
- **方法**: `POST`
- **描述**: 更新用户地理位置
- **访问权限**: 认证用户
- **请求体**:
  ```json
  {
    "latitude": 纬度,
    "longitude": 经度,
    "address": "地址"
  }
  ```
- **响应**: 返回更新后的位置信息

#### 添加用户常用地址

- **路径**: `/api/geolocation/user/address/add`
- **方法**: `POST`
- **描述**: 添加用户常用地址
- **访问权限**: 认证用户
- **请求体**:
  ```json
  {
    "name": "地址名称",
    "address": "详细地址",
    "latitude": 纬度,
    "longitude": 经度,
    "isDefault": 是否默认
  }
  ```
- **响应**: 返回添加的地址信息

#### 获取用户常用地址列表

- **路径**: `/api/geolocation/user/addresses`
- **方法**: `GET`
- **描述**: 获取用户常用地址列表
- **访问权限**: 认证用户
- **响应**: 返回地址列表

#### 删除用户常用地址

- **路径**: `/api/geolocation/user/address/:id`
- **方法**: `DELETE`
- **描述**: 删除用户常用地址
- **访问权限**: 认证用户
- **响应**: 返回删除结果

## 管理员 API

所有管理员 API 都需要认证令牌和管理员权限。

### 用户管理

#### 获取所有用户

- **路径**: `/api/admin/users`
- **方法**: `GET`
- **描述**: 获取所有用户
- **访问权限**: 仅管理员
- **响应**: 返回用户列表

#### 获取用户详情

- **路径**: `/api/admin/users/:userId`
- **方法**: `GET`
- **描述**: 获取用户详情
- **访问权限**: 仅管理员
- **响应**: 返回用户详情

#### 更新用户信息

- **路径**: `/api/admin/users/:userId`
- **方法**: `PATCH`
- **描述**: 更新用户信息
- **访问权限**: 仅管理员
- **请求体**: 需要更新的字段
- **响应**: 返回更新后的用户信息

#### 删除用户

- **路径**: `/api/admin/users/:userId`
- **方法**: `DELETE`
- **描述**: 删除用户
- **访问权限**: 仅管理员
- **响应**: 返回删除结果

#### 更新用户状态

- **路径**: `/api/admin/users/:userId/status`
- **方法**: `PATCH`
- **描述**: 更新用户状态
- **访问权限**: 仅管理员
- **请求体**:
  ```json
  {
    "status": "active/inactive"
  }
  ```
- **响应**: 返回更新后的状态

#### 更新用户角色

- **路径**: `/api/admin/users/:userId/role`
- **方法**: `PATCH`
- **描述**: 更新用户角色
- **访问权限**: 仅管理员
- **请求体**:
  ```json
  {
    "role": "teacher/parent/admin"
  }
  ```
- **响应**: 返回更新后的角色

### 教师管理

#### 获取所有教师

- **路径**: `/api/admin/tutors`
- **方法**: `GET`
- **描述**: 获取所有教师
- **访问权限**: 仅管理员
- **响应**: 返回教师列表

#### 获取教师详情

- **路径**: `/api/admin/tutors/:tutorId`
- **方法**: `GET`
- **描述**: 获取教师详情
- **访问权限**: 仅管理员
- **响应**: 返回教师详情

#### 验证教师资格

- **路径**: `/api/admin/tutors/:tutorId/verify`
- **方法**: `PATCH`
- **描述**: 验证教师资格
- **访问权限**: 仅管理员
- **请求体**:
  ```json
  {
    "verified": true/false,
    "reason": "原因（可选）"
  }
  ```
- **响应**: 返回更新后的验证状态

#### 更新教师状态

- **路径**: `/api/admin/tutors/:tutorId/status`
- **方法**: `PATCH`
- **描述**: 更新教师状态
- **访问权限**: 仅管理员
- **请求体**:
  ```json
  {
    "status": "active/inactive"
  }
  ```
- **响应**: 返回更新后的状态

### 内容审核

#### 获取所有帖子

- **路径**: `/api/admin/posts`
- **方法**: `GET`
- **描述**: 获取所有帖子
- **访问权限**: 仅管理员
- **响应**: 返回帖子列表

#### 获取帖子详情

- **路径**: `/api/admin/posts/:postId`
- **方法**: `GET`
- **描述**: 获取帖子详情
- **访问权限**: 仅管理员
- **响应**: 返回帖子详情

#### 更新帖子状态

- **路径**: `/api/admin/posts/:postId/status`
- **方法**: `PATCH`
- **描述**: 更新帖子状态
- **访问权限**: 仅管理员
- **请求体**:
  ```json
  {
    "status": "approved/rejected/pending"
  }
  ```
- **响应**: 返回更新后的状态

#### 删除帖子

- **路径**: `/api/admin/posts/:postId`
- **方法**: `DELETE`
- **描述**: 删除帖子
- **访问权限**: 仅管理员
- **响应**: 返回删除结果

#### 获取被举报的帖子

- **路径**: `/api/admin/posts/reported`
- **方法**: `GET`
- **描述**: 获取被举报的帖子
- **访问权限**: 仅管理员
- **响应**: 返回被举报的帖子列表

#### 审核帖子

- **路径**: `/api/admin/posts/:postId/review`
- **方法**: `POST`
- **描述**: 审核帖子
- **访问权限**: 仅管理员
- **请求体**:
  ```json
  {
    "action": "approve/reject",
    "reason": "原因（可选）"
  }
  ```
- **响应**: 返回审核结果

### 系统设置

#### 获取系统设置

- **路径**: `/api/admin/settings`
- **方法**: `GET`
- **描述**: 获取系统设置
- **访问权限**: 仅管理员
- **响应**: 返回系统设置

#### 更新系统设置

- **路径**: `/api/admin/settings`
- **方法**: `PATCH`
- **描述**: 更新系统设置
- **访问权限**: 仅管理员
- **请求体**: 需要更新的设置
- **响应**: 返回更新后的设置

### 数据统计

#### 用户统计

- **路径**: `/api/admin/statistics/users`
- **方法**: `GET`
- **描述**: 获取用户统计数据
- **访问权限**: 仅管理员
- **响应**: 返回用户统计数据

#### 教师统计

- **路径**: `/api/admin/statistics/tutors`
- **方法**: `GET`
- **描述**: 获取教师统计数据
- **访问权限**: 仅管理员
- **响应**: 返回教师统计数据

#### 帖子统计

- **路径**: `/api/admin/statistics/posts`
- **方法**: `GET`
- **描述**: 获取帖子统计数据
- **访问权限**: 仅管理员
- **响应**: 返回帖子统计数据

#### 匹配统计

- **路径**: `/api/admin/statistics/matches`
- **方法**: `GET`
- **描述**: 获取匹配统计数据
- **访问权限**: 仅管理员
- **响应**: 返回匹配统计数据

## 消息交流 API

所有消息交流 API 都需要认证令牌。

### 获取用户的所有对话

- **路径**: `/api/messages/conversations`
- **方法**: `GET`
- **描述**: 获取当前用户的所有对话列表
- **访问权限**: 认证用户
- **响应**: 返回对话列表，包括每个对话的未读消息数

### 获取或创建与特定用户的对话

- **路径**: `/api/messages/conversations`
- **方法**: `POST`
- **描述**: 获取或创建与特定用户的对话
- **访问权限**: 认证用户
- **请求体**:
  ```json
  {
    "otherUserId": "用户ID",
    "type": "对话类型(general/consultation/feedback/schedule)",
    "title": "对话标题（可选）"
  }
  ```
- **响应**: 返回对话信息

### 获取对话消息

- **路径**: `/api/messages/conversations/:conversationId`
- **方法**: `GET`
- **描述**: 获取特定对话的消息列表
- **访问权限**: 认证用户（对话参与者）
- **查询参数**:
  - `page`: 页码
  - `limit`: 每页数量
- **响应**: 返回消息列表和分页信息

### 发送消息

- **路径**: `/api/messages/send`
- **方法**: `POST`
- **描述**: 发送消息
- **访问权限**: 认证用户（对话参与者）
- **请求体**:
  ```json
  {
    "conversationId": "对话ID",
    "content": "消息内容",
    "messageType": "消息类型(text/image/file/audio)",
    "mediaUrl": "媒体URL（如果是媒体消息）"
  }
  ```
- **响应**: 返回发送的消息

### 标记消息为已读

- **路径**: `/api/messages/mark-read`
- **方法**: `POST`
- **描述**: 将多条消息标记为已读
- **访问权限**: 认证用户（消息接收者）
- **请求体**:
  ```json
  {
    "messageIds": ["消息ID1", "消息ID2", ...]
  }
  ```
- **响应**: 返回更新的消息数量

### 获取未读消息数

- **路径**: `/api/messages/unread`
- **方法**: `GET`
- **描述**: 获取当前用户的未读消息数
- **访问权限**: 认证用户
- **响应**: 返回总未读消息数和每个对话的未读消息数

### 删除消息

- **路径**: `/api/messages/:messageId`
- **方法**: `DELETE`
- **描述**: 删除消息
- **访问权限**: 认证用户（消息发送者）
- **响应**: 返回删除结果

### 归档对话

- **路径**: `/api/messages/conversations/:conversationId/archive`
- **方法**: `PATCH`
- **描述**: 归档对话
- **访问权限**: 认证用户（对话参与者）
- **响应**: 返回归档结果

### 恢复已归档的对话

- **路径**: `/api/messages/conversations/:conversationId/restore`
- **方法**: `PATCH`
- **描述**: 恢复已归档的对话
- **访问权限**: 认证用户（对话参与者）
- **响应**: 返回恢复结果
